package com.xuyuan.j2ee.servlet.weibo;import java.io.IOException;import java.io.PrintWriter;import java.util.ArrayList;import java.util.List;import javax.servlet.ServletException;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import net.sf.json.JSONArray;/** * 模拟微博的数据滚动加载 * http://www.iteye.com/topic/825564 * http://localhost:8888/start_j2ee/jquery/weibo-scroll.jsp * @author Administrator * */public class DataServlet extends javax.servlet.http.HttpServlet {	static final long serialVersionUID = 1L;	/**	 * @uml.property  name="list"	 */	List<Object[]> list = new ArrayList<Object[]>();// 缓存人员数据	/*	 * 初始化人员数据	 */	public DataServlet() {		super();		for (int i = 0; i < 20007; i++) {			Object[] obj = new Object[4];			obj[0] = i;			obj[1] = (i + 1) % 1000;			obj[2] = "person" + i;			if (i % 2 == 0)				obj[3] = "吃饭睡觉打游戏无聊发呆";			else				obj[3] = "打篮球打乒乓球等等";			list.add(obj);		}	}	protected void doGet(HttpServletRequest request,			HttpServletResponse response) throws ServletException, IOException {		doPost(request, response);	}	protected void doPost(HttpServletRequest request,			HttpServletResponse response) throws ServletException, IOException {		request.setCharacterEncoding("utf-8");		response.setCharacterEncoding("utf-8");		PrintWriter out = response.getWriter();		try {			String start = request.getParameter("start");			String length = request.getParameter("length");			int iStart = Integer.parseInt(start);			int iLength = Integer.parseInt(length);			int iEnd = iStart + iLength > list.size() ? list.size() : iStart					+ iLength;			JSONArray ja = JSONArray.fromObject(list.subList(iStart, iEnd));			out.print("{'total':" + list.size() + ",'data':" + ja.toString()					+ "}");		} catch (Exception e) {			out.print(e.getMessage());		}		out.flush();		out.close();	}}