package com.xuyuan.chart.jfreechart.util;import java.awt.Font;import java.io.FileOutputStream;import java.io.OutputStream;import java.util.Random;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession;import org.apache.struts2.ServletActionContext;import org.apache.struts2.dispatcher.StrutsResultSupport;import org.jfree.chart.ChartUtilities;import org.jfree.chart.JFreeChart;import org.jfree.chart.servlet.ServletUtilities;import org.jfree.chart.title.TextTitle;import com.opensymphony.xwork2.ActionInvocation;/** * 自定义返回类型 * @author Administrator * */public class MyChartResult extends StrutsResultSupport{	private static final long serialVersionUID = 4199494785336139337L;    /**	 * @uml.property  name="width"	 */    private int width;	//图片宽度    /**	 * @uml.property  name="height"	 */    private int height;	//图片高度    /**	 * @uml.property  name="imageType"	 */    private String imageType;	//图片类型 jpg,png    @Override    protected void doExecute(String arg0, ActionInvocation invocation) throws Exception {    	JFreeChart chart =(JFreeChart) invocation.getStack().findValue("chart");        chart.setTitle(new TextTitle(chart.getTitle().getText(), new Font("simsun", Font.BOLD+Font.PLAIN, 13)));		chart.getLegend().setItemFont(new Font("simsun", Font.PLAIN, 11));		//采用浏览器流的方式:直接写到页面.即访问某个URL,在页面上直接显示图片        HttpServletResponse response = ServletActionContext.getResponse();        response.setCharacterEncoding("UTF-8");        OutputStream os = response.getOutputStream();        if("jpeg".equalsIgnoreCase(imageType) || "jpg".equalsIgnoreCase(imageType))            ChartUtilities.writeChartAsJPEG(os, chart, width, height);        else if("png".equalsIgnoreCase(imageType))            ChartUtilities.writeChartAsPNG(os, chart, width, height);        else            ChartUtilities.writeChartAsJPEG(os, chart, width, height);        os.flush();        //Session方式        //HttpSession session = ServletActionContext.getRequest().getSession();        //ServletUtilities.saveChartAsPNG(chart, width, height, session);        //采用文件流的方式:存储到硬盘下        FileOutputStream fos = new FileOutputStream("D:/jfreechart-" + new Long(new Random().nextInt(1000000)) +".png");//存储到绝对路径下    	//FileOutputStream fos = new FileOutputStream("jfreechart-" + new Long(new Random().nextInt(1000000)) + ".png");//存储到工程目录下    	//FileOutputStream fos = new FileOutputStream("/tmp/jfreechart-" + new Long(new Random().nextInt(1000000)) + ".png");//存储到D:/tmp/        ChartUtilities.writeChartAsJPEG(fos,1.0f,chart,width,height,null);		fos.close();    }    /**	 * @param height	 * @uml.property  name="height"	 */    public void setHeight(int height) {        this.height = height;    }    /**	 * @param width	 * @uml.property  name="width"	 */    public void setWidth(int width) {        this.width = width;    }    /**	 * @param imageType	 * @uml.property  name="imageType"	 */    public void setImageType(String imageType) {        this.imageType = imageType;    }}